<VirtualHost *:80>
	WSGIDaemonProcess security user=www-data group=www-data processes=1 threads=1
	WSGIScriptAlias /security /srv/security/routes.py

	ServerAdmin webmaster@localhost

	RedirectMatch 302 ^/$ /security/

	Alias /media /srv/motion

	AddExternalAuth pwauth /usr/sbin/pwauth
	SetExternalAuthMethod pwauth pipe

	<Directory />
		Options FollowSymLinks
		AllowOverride None
	</Directory>

	<Directory /srv/security/>
        	AuthType Basic
                AuthName "Media Archive"
                AuthBasicProvider external
                AuthExternal pwauth
                Require group users

		WSGIProcessGroup security 
        	WSGIApplicationGroup %{GLOBAL}
	</Directory>

	<Directory /srv/motion/>
		Options Indexes Multiviews

		AuthType Basic
		AuthName "Media Archive"
		AuthBasicProvider external
		AuthExternal pwauth
		Require group users
	</Directory>

	ProxyPass /camera0 http://localhost:8081

	<Location /camera0>
		AuthType Basic
                AuthName "Media Archive"
                AuthBasicProvider external
                AuthExternal pwauth
                Require group users
	</Location>

	ErrorLog ${APACHE_LOG_DIR}/error.log

	LogLevel warn

	CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
